# 实验1.2

## 变量集合

​	变量集合对应班次的集合，值班天数为 $D$ ，每日轮班次数为 $S$ 时，共有 $D \ast S$ 个班次，对应 $D \ast S$ 个变量。

## 值域集合

​	值域集合为每个班次可选的宿管阿姨的编号，当阿姨的数量为 $N$ 时，初始值域集合即为 $[1,N]$

## 约束集合

​	约束集合包含两类约束，第一类约束为任何两个相邻班次对应的变量的值不相等，即同一个宿管阿姨不能连续工作两个班次。第二类约束为任意 $[1,N]$ 之间的编号 $i$ ，取值为 $i$ 的变量的个数不少于 $\lfloor \frac{D \ast S}{N}  \rfloor$

## 算法思路

​	采用回溯法，依次分配每个班次的变量的值，直到分配完成或者不能再继续分配时进行回溯，以找到满足约束的解。在分配时优先考虑已经排班的次数较少的阿姨，以便阿姨的值班次数平均分配。使用最少剩余值启发式、向前检查、约束传播的优化技术来加速求解。为了尽可能最大化满足的请求数，向约束集合加入新的约束，新的约束为满足的请求数>= $x$ ， $x$ 的初始值设为 $D \ast S$ ，若这样的解不存在，令  $x=x-1$继续求解，反复减小 $x$ 的值，直到存在解为止，若 $x=0$ 时仍不存在解，则该问题无解。

## 最少剩余值启发式

​	查看变量集合中尚未分配的变量，选取值域中剩余值最少的变量作为下一个分配的变量，因为这样的变量的可选值较少，先分配这样的变量可以减小搜索树的大小，降低搜索复杂度。

## 向前检查

​	将当前分配的变量对应的班次的前后两个班次对应的变量的值域中删去当前分配的变量的分配值，因为约束中不允许两个相邻班次对应的变量的值相等。这样可以减少相邻班次的值域，从而减小搜索树的大小，降低搜索复杂度。

## 约束传播

​	对于任意 $[1,N]$ 之间的编号 $i$ ，计算其已经分配给的变量的个数和仍在变量值域中但尚未分配的变量的个数，若两者之和小于 $\lfloor \frac{D \ast S}{N}  \rfloor$ 则继续搜索已经不可能满足取值为 $i$ 的变量的个数不少于 $\lfloor \frac{D \ast S}{N}  \rfloor$ 的约束，可以进行剪枝。

​	计算当前已经分配并且满足请求的变量数和尚未分配但值域中含有满足请求的值的变量数，若两者之和小于 $x$ ，则继续搜索已经不可能满足满足的请求数>= $x$ ，可以进行剪枝。

​	利用约束传播可以对于继续搜索已经不可能满足约束的状态进行剪枝，从而提前回溯，降低搜索复杂度。

## input0.txt 中的安排方式

安排方式如下

```
1,2,3
1,3,2
3,2,1
3,1,2
1,2,1
3,2,3
1,2,3
20
```

第⼀行第 1 天的三班分别由第1,2,3号阿姨值班；

第二行第 2 天的三班分别由第1,3,2号阿姨值班；

第三行第 3 天的三班分别由第3,2,1号阿姨值班；

第四行第 4 天的三班分别由第3,1,2号阿姨值班；

第五行第 5 天的三班分别由第1,2,1号阿姨值班；

第六行第 6 天的三班分别由第3,2,3号阿姨值班；

第七行第 7 天的三班分别由第1,2,3号阿姨值班；

其中1号阿姨值班7次，2号阿姨值班7次，3号阿姨值班7次，满足每个宿管阿姨在整个排班周期中，应至少被分配到 $\lfloor \frac{D \ast S}{N}   \rfloor = 7$ 次值班。并且同⼀个宿管阿姨没有连续工作两个班次。此时满足的请求的个数为20。

